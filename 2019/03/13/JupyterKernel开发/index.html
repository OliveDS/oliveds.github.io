<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/olive-appletouch.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/olive-logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="引言一直深受搭环境的困扰,今天鼓起勇气找蔡博讨论了一下,结果发现之前的方向其实是错误的,现在的任务其实是IDE的重新开发,只需要重新写个kernel,后端依然使用旧IDE的,因为以后平台需要跑在JDK8上,所以先看IJAVA kernel的代码,然后看一下怎么把kernel和现在IDE的后端连接起来.还有就是不能直接使用Jupyter的界面,要包个壳,起码要换个配色,#882929 今天跟蔡博聊过">
<meta property="og:type" content="article">
<meta property="og:title" content="Jupyter Kernel 开发">
<meta property="og:url" content="https://oliveds.github.io/2019/03/13/JupyterKernel开发/index.html">
<meta property="og:site_name" content="OliveDS&#39;s Study Bar">
<meta property="og:description" content="引言一直深受搭环境的困扰,今天鼓起勇气找蔡博讨论了一下,结果发现之前的方向其实是错误的,现在的任务其实是IDE的重新开发,只需要重新写个kernel,后端依然使用旧IDE的,因为以后平台需要跑在JDK8上,所以先看IJAVA kernel的代码,然后看一下怎么把kernel和现在IDE的后端连接起来.还有就是不能直接使用Jupyter的界面,要包个壳,起码要换个配色,#882929 今天跟蔡博聊过">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/INashornJS.png">
<meta property="og:image" content="http://andrew.gibiansky.com/blog/ipython/ipython-kernels/images/ipython.png">
<meta property="og:image" content="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/basekernel-index.png">
<meta property="og:image" content="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/notebook-package-json.png">
<meta property="og:image" content="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/jupyter-dev.png">
<meta property="og:image" content="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/web-pics/button-run.png">
<meta property="og:updated_time" content="2019-04-02T09:44:42.076Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jupyter Kernel 开发">
<meta name="twitter:description" content="引言一直深受搭环境的困扰,今天鼓起勇气找蔡博讨论了一下,结果发现之前的方向其实是错误的,现在的任务其实是IDE的重新开发,只需要重新写个kernel,后端依然使用旧IDE的,因为以后平台需要跑在JDK8上,所以先看IJAVA kernel的代码,然后看一下怎么把kernel和现在IDE的后端连接起来.还有就是不能直接使用Jupyter的界面,要包个壳,起码要换个配色,#882929 今天跟蔡博聊过">
<meta name="twitter:image" content="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/INashornJS.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://oliveds.github.io/2019/03/13/JupyterKernel开发/">





  <title>Jupyter Kernel 开发 | OliveDS's Study Bar</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">OliveDS's Study Bar</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一个小小码农的学习分享</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://oliveds.github.io/2019/03/13/JupyterKernel开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="OliveDS">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OliveDS's Study Bar">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Jupyter Kernel 开发</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-13T17:50:09+08:00">
                2019-03-13
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2019-04-02T17:44:42+08:00">
                2019-04-02
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jupyter/" itemprop="url" rel="index">
                    <span itemprop="name">Jupyter</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/13/JupyterKernel开发/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/03/13/JupyterKernel开发/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/03/13/JupyterKernel开发/" class="leancloud_visitors" data-flag-title="Jupyter Kernel 开发">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>一直深受搭环境的困扰,今天鼓起勇气找蔡博讨论了一下,结果发现之前的方向其实是错误的,现在的任务其实是IDE的重新开发,只需要重新写个kernel,后端依然使用旧IDE的,因为以后平台需要跑在JDK8上,所以先看IJAVA kernel的代码,然后看一下怎么把kernel和现在IDE的后端连接起来.还有就是不能直接使用Jupyter的界面,要包个壳,起码要换个配色,#882929</p>
<p>今天跟蔡博聊过之后感觉…emmm,有不懂的问题真的要直接提问,赶紧问,不要怕丢脸,真的,不要端着,人笨就要多提问,我要赶紧改正太在意别人怎么看我的缺点,我天下第一笨,还有就是别人其实根本没想那么多,是我overthink,以后一定要做最笨的人+最不要脸的人,其实学长们都很好的</p>
<h1 id="IJAVA-Kernel-安装"><a href="#IJAVA-Kernel-安装" class="headerlink" title="IJAVA Kernel 安装"></a>IJAVA Kernel 安装</h1><h2 id="双-JDK安装"><a href="#双-JDK安装" class="headerlink" title="(双)JDK安装"></a>(双)JDK安装</h2><p>首先需要JDK&gt;9的环境,我别的开发需要JDK7不想卸,参考⤵️</p>
<p><a href="https://www.jianshu.com/p/913b5168ed6e" target="_blank" rel="noopener">https://www.jianshu.com/p/913b5168ed6e</a></p>
<p>亲测好使,随时切换</p>
<h2 id="IJAVA-Kernel-安装-1"><a href="#IJAVA-Kernel-安装-1" class="headerlink" title="IJAVA Kernel 安装"></a>IJAVA Kernel 安装</h2><p><a href="https://github.com/SpencerPark/IJava" target="_blank" rel="noopener">https://github.com/SpencerPark/IJava</a></p>
<p>有多种安装方式,我用的是Install pre-built binary</p>
<p>比较常用的安装选项是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python3 install.py --sys-prefix </span><br><span class="line"><span class="meta">#</span>会安装在/usr/local/Cellar/python/3.7.2_2/Frameworks/Python.framework/Versions/3.7/share/jupyter/kernels/java"</span><br><span class="line">python3 install.py</span><br><span class="line"><span class="meta">#</span>会安装在/usr/local/share/jupyter/kernels/java</span><br></pre></td></tr></table></figure>
<p>因为我并不希望它依赖Python,所以使用了第二种方式.<del>其实是用第一种然后又删了重装的</del></p>
<p>另一种安装方法使用 <code>gradlew</code>,会是我们自己编写的kernel使用的安装方式,见下一节</p>
<p>安装完成后,在命令行中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook</span><br></pre></td></tr></table></figure>
<p>发现kernel选项中多了java的选择,可以输入一个<code>System.out.println(&quot;Hello World&quot;)</code>测试,然后<code>Shift+Enter</code>执行,发现打印成功就证明安装地没问题</p>
<h1 id="JVM-BaseKernel-使用"><a href="#JVM-BaseKernel-使用" class="headerlink" title="JVM BaseKernel 使用"></a>JVM BaseKernel 使用</h1><p>在GitHub上的源码地址👇</p>
<p><a href="https://github.com/SpencerPark/jupyter-jvm-basekernel" target="_blank" rel="noopener">https://github.com/SpencerPark/jupyter-jvm-basekernel</a></p>
<p>实际上我们需要写的部分就是源码中<code>example</code>文件夹中的内容. 利用BaseKernel提供的一系列接口和自己language的接口,完成一个Kernel.</p>
<p>其实也不是需要全部自己写,直接对<code>example</code>进行修改就行了.所以先能够把<code>example</code>build成功跑起来,就成功了一半(哈?give or take…🤷‍♀️)</p>
<p>官网的使用教程说在<code>build.gradle</code>中添加以下内容就可以使用BaseKernel了</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    <span class="comment">// If using a SNAPSHOT version, otherwise maven central is fine</span></span><br><span class="line">    <span class="comment">// maven &#123; url = 'https://oss.sonatype.org/content/repositories/snapshots/' &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// If using a release version (no SNAPSHOT suffix)</span></span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">group:</span> <span class="string">'io.github.spencerpark'</span>, <span class="string">name:</span> <span class="string">'jupyter-jvm-basekernel'</span>, <span class="string">version:</span> <span class="string">'2.2.3'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但实际上<code>example</code>的<code>build.gradle</code>也已经包含这部分内容了.而且也已经写好了安装的指令,执行下面指令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod u+x gradlew</span><br><span class="line">./gradlew installKernel</span><br></pre></td></tr></table></figure>
<p>就可以安装Kernel了</p>
<p>但是我在安装<code>example</code>的时候遇到了下面的错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Failed to execute: python3 -c &quot;import jupyter_core.paths as j; print(j.SYSTEM_JUPYTER_PATH[0])&quot;.</span><br><span class="line">Stdout:</span><br><span class="line"></span><br><span class="line">Stderr:</span><br><span class="line">          File &quot;&lt;string&gt;&quot;, line 1</span><br><span class="line">    &quot;import</span><br><span class="line">          ^</span><br><span class="line">SyntaxError: EOL while scanning string literal</span><br><span class="line"></span><br><span class="line">FAILURE: Build failed with an exception.</span><br><span class="line"></span><br><span class="line">* What went wrong:</span><br><span class="line">Execution failed for task &apos;:installKernel&apos;.</span><br><span class="line">&gt; Could not get jupyter data-dir.</span><br><span class="line"></span><br><span class="line">* Try:</span><br><span class="line">Run with --stacktrace option to get the stack trace. Run with --debug option to get more log output. Run with --scan to get full insights.</span><br><span class="line"></span><br><span class="line">* Get more help at https://help.gradle.org</span><br><span class="line"></span><br><span class="line">Deprecated Gradle features were used in this build, making it incompatible with Gradle 5.0.</span><br><span class="line">See https://docs.gradle.org/4.8.1/userguide/command_line_interface.html#sec:command_line_warnings</span><br><span class="line"></span><br><span class="line">BUILD FAILED in 0s</span><br><span class="line">2 actionable tasks: 2 up-to-date</span><br></pre></td></tr></table></figure>
<p>其实就是一条获取Jupyter Dir的指令<code>python3 -c &quot;import jupyter_core.paths as j; print(j.SYSTEM_JUPYTER_PATH[0])&quot;</code>没能执行成功,但是这个指令我在命令行是可以成功执行的,输出结果为<code>/usr/local/share/jupyter</code>. 因为报的错是<code>EOL while scanning string literal</code>所以可能是引号的使用有问题?我在整个BaseKernel的文件夹中搜索这条指令或者installKernel的指令都没有搜到结果,所以这可能是Jupyter的脚本中的?但是我使用同样的指令来安装IJAVAKernel就你没有报错.</p>
<p>查了一下<code>gradlew</code>是Windows版本的<code>Gradle</code>,可执行文件包含在了BaseKernel中,但其实它是个程序来着,用来执行<code>gradl-wrapper</code></p>
<blockquote>
<p>The gradle-wrapper is specific to every project and can only be invoked inside the project’s directory, using the command <code>./gradlew (arguments)</code>.</p>
</blockquote>
<blockquote>
<p> gradle是一个项目<a href="https://link.zhihu.com/?target=http%3A//zh.wikipedia.org/wiki/%25E8%2587%25AA%25E5%258B%2595%25E5%258C%2596%25E5%25BB%25BA%25E6%25A7%258B" target="_blank" rel="noopener">自动化建构</a>工具.</p>
<ul>
<li>差异管理:可实现静态级的差异控制,避免了针对不同设备产生的冗余代码</li>
<li>依赖管理:自动装载到~/.gradle/下,完成classpath等配置</li>
<li>…</li>
</ul>
<p>Gradle通过编写一个名为build.gradle的脚本文件对项目进行设置，再根据这个脚本对项目进行构建（复杂的项目也有其他文件）</p>
</blockquote>
<p>BaseKernel直接提供给你了Gradle Wrapper</p>
<blockquote>
<p>Gradle Wrapper 允许你在没有安装 Gradle 的机器上执行 Gradle 构建。 这一点是非常有用的。比如，对一些持续集成服务来说。 它对一个开源项目保持低门槛构建也是非常有用的。 Wrapper 对企业来说也很有用，它使得对客户端计算机零配置。 它强制使用指定的版本，以减少兼容支持问题。</p>
</blockquote>
<p>通过查看<code>(project&#39;s root folder=)example/gradle/wrapper/gradle-wrapper.properties</code>发现这个project使用的是gradle 4.8.1,所以这里要注意不要用JDK11+(含),因为Gradle5才有了对它们的支持</p>
<p>后来上网查资料发现,这个<code>installKernel</code>是通过增加plugin实现的,源码在此👇</p>
<p><a href="https://github.com/SpencerPark/Jupyter-kernel-installer-gradle" target="_blank" rel="noopener">https://github.com/SpencerPark/Jupyter-kernel-installer-gradle</a></p>
<p>好吧,但对我找BUG并没有什么帮助…</p>
<ol>
<li>不可能是真的EOL String 错误,因为这是个稳定可用的代码,且IJAVA中执行正常,所以排除了是这段代码的问题</li>
<li>只能对比BaseKernel和IJAVA的区别,可能是配置文件区别导致的 ✅</li>
<li>可以找一下Nachorn Kernel单独的源码包,进行安装 ❎</li>
</ol>
<p>我对比了IJAVA和example的<code>build.gradle</code>文件,发现跟这个指令相关的一项设置</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">installKernel &#123;</span><br><span class="line">    kernelInstallPath = commandLineSpecifiedPath(userInstallPath)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在IJAVA中有,而example中没有,在example中添加后,居然执行成功了!!!😱</p>
<p><img src="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/INashornJS.png" alt></p>
<p>(这里我截图的时候Jupyter连接已经断开了,不过你能看到是能够正常执行的啦,而且具有自动补全的功能)</p>
<p>妈耶,可以愉快地编程<del>(改代码)</del>了</p>
<h1 id="IPython-Kernel"><a href="#IPython-Kernel" class="headerlink" title="IPython Kernel"></a>IPython Kernel</h1><p>IPython提供了5个接口,与Jupyter前端页面进行信息交换;另外,Kernel背靠Python engine,将用户指令发给engine执行然后获取运行结果返回给用户.</p>
<p><strong>(我浅显的理解,如果有误请纠正)</strong></p>
<p><img src="http://andrew.gibiansky.com/blog/ipython/ipython-kernels/images/ipython.png" alt></p>
<h1 id="JVM-BaseKernel"><a href="#JVM-BaseKernel" class="headerlink" title="JVM BaseKernel"></a>JVM BaseKernel</h1><p>三种功能(位于BaseKernel.java,被子类YJSKernel重写):</p>
<ol>
<li>eval</li>
<li>inspect</li>
<li>complete</li>
</ol>
<p>N种消息: 具有对应的HandleXXXRequest()函数,</p>
<ol>
<li>handleExecuteRequest() (调用eval函数)</li>
<li></li>
</ol>
<h1 id="INachornJS-Kernel"><a href="#INachornJS-Kernel" class="headerlink" title="INachornJS Kernel"></a>INachornJS Kernel</h1><p><code>JVM BaseKernel</code>是一个提供了通信(messaging)和基本操作(还包括代码检查补全)功能的BASE(名副其实)</p>
<p>而<code>example</code>文件夹是利用这个Base实现的一个实际Kernel(<code>INashornJS Kernel</code>) ,其中起到功能作用的代码只有<code>INashornJS.java</code>和<code>NashornKernel.java</code>这两个文件(🤔看起来好像不难改)</p>
<p><img src="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/basekernel-index.png" alt></p>
<h2 id="INashornJS-java"><a href="#INashornJS-java" class="headerlink" title="INashornJS.java"></a>INashornJS.java</h2><p>主要是对文件进行检查,创建Handler,然后与Jupyter建立连接. </p>
<p>这个代码可以直接使用在新写的Kernel中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.spencerpark.jupyter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.github.spencerpark.jupyter.channels.JupyterConnection;</span><br><span class="line"><span class="keyword">import</span> io.github.spencerpark.jupyter.channels.JupyterSocket;</span><br><span class="line"><span class="keyword">import</span> io.github.spencerpark.jupyter.kernel.KernelConnectionProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Level;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个文件可以直接照搬,只需要改类名</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">INashornJS</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">1</span>) <span class="comment">//需要传文件名 谁调用?</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Missing connection file argument"</span>);</span><br><span class="line"></span><br><span class="line">        Path connectionFile = Paths.get(args[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!Files.isRegularFile(connectionFile))<span class="comment">//对文件进行检查</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Connection file '"</span> + connectionFile + <span class="string">"' isn't a file."</span>);</span><br><span class="line"></span><br><span class="line">        String contents = <span class="keyword">new</span> String(Files.readAllBytes(connectionFile));<span class="comment">//读取文件内容</span></span><br><span class="line"></span><br><span class="line">        JupyterSocket.JUPYTER_LOGGER.setLevel(Level.WARNING);<span class="comment">//java内置Logger,日志</span></span><br><span class="line"></span><br><span class="line">        KernelConnectionProperties connProps = KernelConnectionProperties.parse(contents);<span class="comment">//根据文件设置IP ports</span></span><br><span class="line">        JupyterConnection connection = <span class="keyword">new</span> JupyterConnection(connProps);<span class="comment">//建立连接</span></span><br><span class="line"></span><br><span class="line">        String envEngineArgs = System.getenv(<span class="string">"JS_ENGINE_ARGS"</span>);<span class="comment">//系统环境?运行时?</span></span><br><span class="line">        <span class="keyword">if</span> (envEngineArgs == <span class="keyword">null</span>)</span><br><span class="line">            envEngineArgs = <span class="string">"-scripting"</span>;</span><br><span class="line"></span><br><span class="line">        String[] engineArgs = envEngineArgs.split(<span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">        NashornKernel kernel = <span class="keyword">new</span> NashornKernel(engineArgs);</span><br><span class="line">        kernel.becomeHandlerForConnection(connection);<span class="comment">//与Jupyter建立的连接作为Handler使用?</span></span><br><span class="line"></span><br><span class="line">        connection.connect();</span><br><span class="line">        connection.waitUntilClose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="NashornKernel-java"><a href="#NashornKernel-java" class="headerlink" title="NashornKernel.java"></a>NashornKernel.java</h2><p>这个文件则是调用语言后端提供的接口,具体地实现了代码执行(<code>eval</code>函数),代码检查(<code>inspect</code>函数),代码补全(<code>complete</code>函数)三个功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.spencerpark.jupyter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.github.spencerpark.jupyter.kernel.BaseKernel;</span><br><span class="line"><span class="keyword">import</span> io.github.spencerpark.jupyter.kernel.LanguageInfo;</span><br><span class="line"><span class="keyword">import</span> io.github.spencerpark.jupyter.kernel.ReplacementOptions;</span><br><span class="line"><span class="keyword">import</span> io.github.spencerpark.jupyter.kernel.display.DisplayData;</span><br><span class="line"><span class="keyword">import</span> io.github.spencerpark.jupyter.kernel.util.CharPredicate;</span><br><span class="line"><span class="keyword">import</span> io.github.spencerpark.jupyter.kernel.util.SimpleAutoCompleter;</span><br><span class="line"><span class="keyword">import</span> io.github.spencerpark.jupyter.kernel.util.StringSearch;</span><br><span class="line"><span class="keyword">import</span> jdk.nashorn.api.scripting.NashornScriptEngineFactory;<span class="comment">//不在此kernel中,JDK中</span></span><br><span class="line"><span class="comment">//以下均是语言后端提供的接口,需要替换成自己语言的接口</span></span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptContext;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngine;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStreamWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NashornKernel</span> <span class="keyword">extends</span> <span class="title">BaseKernel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> NashornScriptEngineFactory NASHORN_ENGINE_FACTORY = <span class="keyword">new</span> NashornScriptEngineFactory();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SimpleAutoCompleter autoCompleter = SimpleAutoCompleter.builder()</span><br><span class="line">            .preferLong()</span><br><span class="line">            <span class="comment">//Keywords from a great poem at https://stackoverflow.com/a/12114140</span></span><br><span class="line">            .withKeywords(<span class="string">"let"</span>, <span class="string">"this"</span>, <span class="string">"long"</span>, <span class="string">"package"</span>, <span class="string">"float"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"goto"</span>, <span class="string">"private"</span>, <span class="string">"class"</span>, <span class="string">"if"</span>, <span class="string">"short"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"while"</span>, <span class="string">"protected"</span>, <span class="string">"with"</span>, <span class="string">"debugger"</span>, <span class="string">"case"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"continue"</span>, <span class="string">"volatile"</span>, <span class="string">"interface"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"instanceof"</span>, <span class="string">"super"</span>, <span class="string">"synchronized"</span>, <span class="string">"throw"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"extends"</span>, <span class="string">"final"</span>, <span class="string">"export"</span>, <span class="string">"throws"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"try"</span>, <span class="string">"import"</span>, <span class="string">"double"</span>, <span class="string">"enum"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"false"</span>, <span class="string">"boolean"</span>, <span class="string">"abstract"</span>, <span class="string">"function"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"implements"</span>, <span class="string">"typeof"</span>, <span class="string">"transient"</span>, <span class="string">"break"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"void"</span>, <span class="string">"static"</span>, <span class="string">"default"</span>, <span class="string">"do"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"switch"</span>, <span class="string">"int"</span>, <span class="string">"native"</span>, <span class="string">"new"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"else"</span>, <span class="string">"delete"</span>, <span class="string">"null"</span>, <span class="string">"public"</span>, <span class="string">"var"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"in"</span>, <span class="string">"return"</span>, <span class="string">"for"</span>, <span class="string">"const"</span>, <span class="string">"true"</span>, <span class="string">"char"</span>)</span><br><span class="line">            .withKeywords(<span class="string">"finally"</span>, <span class="string">"catch"</span>, <span class="string">"byte"</span>)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CharPredicate idChar = CharPredicate.builder()</span><br><span class="line">            .inRange(<span class="string">'a'</span>, <span class="string">'z'</span>)</span><br><span class="line">            .inRange(<span class="string">'A'</span>, <span class="string">'Z'</span>)</span><br><span class="line">            .match(<span class="string">'_'</span>)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ScriptEngine engine;<span class="comment">//来源-javax,进行执行函数的engine,重要,需要替换!</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LanguageInfo languageInfo;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NashornKernel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="string">"-scripting"</span>);<span class="comment">////参数:engineArgs-默认值</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NashornKernel</span><span class="params">(String... args)</span> </span>&#123;<span class="comment">//参数:engineArgs</span></span><br><span class="line">        <span class="keyword">this</span>(NASHORN_ENGINE_FACTORY.getScriptEngine(args));<span class="comment">//根据参数获取对应的ScriptEngine</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NashornKernel</span><span class="params">(ScriptEngine engine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = engine;</span><br><span class="line">        <span class="comment">//对使用的版本,格式等进行设置</span></span><br><span class="line">        <span class="keyword">this</span>.languageInfo = <span class="keyword">new</span> LanguageInfo.Builder(engine.getFactory().getLanguageName())</span><br><span class="line">                .version(engine.getFactory().getLanguageVersion())</span><br><span class="line">                .mimetype(<span class="string">"text/javascript"</span>)</span><br><span class="line">                .fileExtension(<span class="string">".js"</span>)</span><br><span class="line">                .pygments(<span class="string">"javascript"</span>)</span><br><span class="line">                .codemirror(<span class="string">"javascript"</span>)</span><br><span class="line">                .build();<span class="comment">//将这些参数设置好后返回对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LanguageInfo <span class="title">getLanguageInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> languageInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DisplayData <span class="title">eval</span><span class="params">(String expr)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//执行指令,输出结果</span></span><br><span class="line">        ScriptContext ctx = engine.getContext();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Redirect the streams</span></span><br><span class="line">        ctx.setWriter(<span class="keyword">new</span> OutputStreamWriter(System.out));</span><br><span class="line">        ctx.setErrorWriter(<span class="keyword">new</span> OutputStreamWriter(System.err));</span><br><span class="line">        ctx.setReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Evaluate the code</span></span><br><span class="line">        Object res = engine.eval(expr, ctx);<span class="comment">//expr??? ctx- 返回执行结果</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//If the evaluation returns a non-null value (the code is an expression like</span></span><br><span class="line">        <span class="comment">// 'a + b') then the return value should be this result as text. Otherwise</span></span><br><span class="line">        <span class="comment">//return null for nothing to be emitted for 'Out[n]'. Side effects may have</span></span><br><span class="line">        <span class="comment">//still printed something</span></span><br><span class="line">        <span class="keyword">return</span> res != <span class="keyword">null</span> ? <span class="keyword">new</span> DisplayData(res.toString()) : <span class="keyword">null</span>;<span class="comment">//将Object结果转换为字符串-再组成DisplayData对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DisplayData <span class="title">inspect</span><span class="params">(String code, <span class="keyword">int</span> at, <span class="keyword">boolean</span> extraDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//输入指令有误,engine返回错误位置-id?,针对id找出出错的variable,输出给用户查看</span></span><br><span class="line">        StringSearch.Range match = StringSearch.findLongestMatchingAt(code, at, idChar);</span><br><span class="line">        String id = <span class="string">""</span>;</span><br><span class="line">        Object val = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (match != <span class="keyword">null</span>) &#123;</span><br><span class="line">            id = match.extractSubString(code);</span><br><span class="line">            val = <span class="keyword">this</span>.engine.getContext().getAttribute(id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DisplayData(val == <span class="keyword">null</span> ? <span class="string">"No memory value for '"</span> + id + <span class="string">"'"</span> : val.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ReplacementOptions <span class="title">complete</span><span class="params">(String code, <span class="keyword">int</span> at)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//代码自动补全</span></span><br><span class="line">        StringSearch.Range match = StringSearch.findLongestMatchingAt(code, at, idChar);</span><br><span class="line">        <span class="keyword">if</span> (match == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        String prefix = match.extractSubString(code);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ReplacementOptions(autoCompleter.autocomplete(prefix), match.getLow(), match.getHigh());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="MyKernel"><a href="#MyKernel" class="headerlink" title="MyKernel"></a>MyKernel</h1><p>Okay🙆,那下一个问题就是如何与后端通信.包含3方面的问题</p>
<ol>
<li>如何import本地project</li>
<li>后端代码中提供了哪些函数接口</li>
<li>如何将这些接口变为engine(INachor)</li>
</ol>
<h2 id="修改Kernel-Name"><a href="#修改Kernel-Name" class="headerlink" title="修改Kernel Name"></a>修改Kernel Name</h2><p>打算先把BaseKernel中的example改成我自己的kernel</p>
<ol>
<li>整个工程文件夹改名,同时修改<code>settings.gradle</code>中的根目录名</li>
<li><code>src/main/java/</code>文件夹下<code>io.github.spencerpark.jupyter.YJS</code>main函数所在的class改名在(<code>build.gradle</code>中<code>Main-class</code>改名)</li>
<li><code>src/main/java/io/github/spencerpark/jupyter</code>文件夹下两个文件改名,并修改文件中的类名</li>
<li>build.gradle中Jupyter字段中一系列Kernel name…改名</li>
</ol>
<h2 id="用Eclipse开发"><a href="#用Eclipse开发" class="headerlink" title="用Eclipse开发"></a>用Eclipse开发</h2><p>因为项目是使用<code>gradle</code>编译的,所以现在本机安装<code>gradle</code>,因为BaseKernel使用的是4.8.1版本,所以我也使用这个版本.在</p>
<p><a href="https://gradle.org/releases/" target="_blank" rel="noopener">https://gradle.org/releases/</a></p>
<p>寻找想要的版本,下载后解压即可(下载二进制版本即可,完整版本包括一系列文档),然后将解压后的<code>bin</code>文件夹加入路径中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/.../.../gradle-4.8.1/bin</span><br></pre></td></tr></table></figure>
<p>然后在eclipse中<code>Help-&gt;Eclipse MarketPlace</code>中搜索<code>buildship</code>并安装</p>
<p>安装完成后,使用<code>import Project</code>将Kernel工程导入进去,选择<code>Exsiting Gradle Project</code>(可能还需要配置一下你的系统Gradle路径?<code>preference-&gt;data management-&gt;gradle</code> 我忘记有没有配了)</p>
<p>工程中用到的依赖包括学长的整个工程生成的jar包<code>yjs.jar</code>,我的方法是在Kernel工程的build.gradle的<code>dependencies</code>字段加入.用Eclipse打开后,<code>Build Path</code>的<code>Source</code>中也自动包含了这个jar.</p>
<p>因为学长的jar就是整个<code>SmartContract</code>工程,所以按照在原来工程中的import方式,即</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import com.yancloud.sc.xxx</span><br></pre></td></tr></table></figure>
<p>应该就可以了,我看到这样调用在gradle build和Eclipse中都不会报错,但是很奇怪的,我用<code>jupyter notebook</code>并运行自己的kernel时,总是会在终端报</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;Shell-0&quot; java.lang.NoClassDefFoundError: com/yancloud/sc/bean/Contract</span><br><span class="line">	at io.github.spencerpark.jupyter.YJSKernel.eval(YJSKernel.java:111)</span><br><span class="line">	at io.github.spencerpark.jupyter.kernel.BaseKernel.handleExecuteRequest(BaseKernel.java:307)</span><br><span class="line">	at io.github.spencerpark.jupyter.channels.ShellChannel.lambda$bind$16(ShellChannel.java:54)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:748)</span><br><span class="line">	at io.github.spencerpark.jupyter.channels.Loop.run(Loop.java:44)</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: com.yancloud.sc.bean.Contract</span><br><span class="line">	at java.net.URLClassLoader.findClass(URLClassLoader.java:382)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)</span><br><span class="line">	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)</span><br><span class="line">	... 5 more</span><br></pre></td></tr></table></figure>
<p>然后在前台的表现就是指令始终处于<code>*</code>运行状态,不会返回任何结果</p>
<p>因为是<code>NoClassDefFoundError</code>,所以我觉得应该是jar包根本没有调用到?那么编译为什么通过了呢?</p>
<p><a href="https://discuss.gradle.org/t/gradle-not-compiling-dependency-jars-in-lib-folder/22186" target="_blank" rel="noopener">https://discuss.gradle.org/t/gradle-not-compiling-dependency-jars-in-lib-folder/22186</a></p>
<p>这个问题好像跟我很相似,根据他的解答,在我的<code>build.gradle</code>中的<code>jar</code>部分添加了</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from configurations.runtime.collect &#123; zipTree(it) &#125;<span class="comment">//添加runtime依赖jar</span></span><br></pre></td></tr></table></figure>
<p>然后终于成功了!感动😭</p>
<h1 id="ContractManager-使用"><a href="#ContractManager-使用" class="headerlink" title="ContractManager 使用"></a>ContractManager 使用</h1><p>ContractManager虽然包含在SmartContract下,但是可以单独运行,所以具有一个main函数(创建一个对象即可运行) 在我的</p>
<p>问题:学长的ContractManager是直接执行一个JS脚本;Jupyter Kernel是每次获取String类型的代码执行然后返回结果的String.并且我们还需要改jupyter的界面,所以应该直接改Jupyter Notebook</p>
<h1 id="Jupyter-Notebook-开发"><a href="#Jupyter-Notebook-开发" class="headerlink" title="Jupyter Notebook 开发"></a>Jupyter Notebook 开发</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> pip3 install --upgrade setuptools pip3 这句我其实没有执行,应该需要都改成pip3吧(新版本jupyter需要Python3)</span><br><span class="line">git clone https://github.com/jupyter/notebook</span><br><span class="line">cd notebook</span><br><span class="line">pip3 install -e .</span><br><span class="line"><span class="meta">#</span> 每次修改后 Rebuilding JavaScript and CSS</span><br><span class="line">npm run build</span><br><span class="line"><span class="meta">#</span> 或</span><br><span class="line">npm run build:watch</span><br></pre></td></tr></table></figure>
<p>我执行<code>npm run build</code>指令后报错,原因是系统默认<code>Python</code>为2.7版本,而在Jupyter需要3.x,所以需要将这个指令修改为<code>python3 …</code></p>
<p>可以通过下面这个指令查看npm可以执行的指令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ npm run</span><br><span class="line">Scripts available in jupyter-notebook-deps via `npm run-script`:</span><br><span class="line">  bower</span><br><span class="line">    bower install</span><br><span class="line">  build</span><br><span class="line">    python setup.py js css</span><br><span class="line">  build:watch</span><br><span class="line">    set -e; while true; do npm run build; sleep 3; done</span><br></pre></td></tr></table></figure>
<p>npm是<code>Node.js</code>提供的包管理工具,它自动化得执行当前路径下的<code>package.json</code>文档中的指令(也就是上面查看到的),找到<code>notebook</code>中的<code>package.json</code>文件,将python修改为<code>python3</code>就可以了</p>
<p><img src="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/notebook-package-json.png" alt></p>
<p>然后就可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook</span><br></pre></td></tr></table></figure>
<p>运行你的开发模式的jupyter notebook了</p>
<p>(怎么确认你运行的是开发模式的而不是之前安装的普通用户模式的呢,在运行起来的jupyter界面中点<code>Help</code>-&gt;<code>About</code>-&gt;查看版本中是否包含<code>dev</code>)</p>
<p><img src="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/jupyter-dev.png" alt></p>
<p>可以看到包含<code>dev</code>,没问题了</p>
<h2 id="Jupyter-架构"><a href="#Jupyter-架构" class="headerlink" title="Jupyter 架构"></a>Jupyter 架构</h2><p><a href="https://jupyter.readthedocs.io/en/latest/architecture/how_jupyter_ipython_work.html" target="_blank" rel="noopener">理解Jupyter&amp;IPython</a></p>
<p>我的理解: </p>
<p> Kernel: IPython/YJS Kernel都是REPL(Read–eval–print loop),作为内核,执行代码</p>
<p>(我们使用第二种开发Kernel的开发,所以实际上与IPython完全是平行/无关的关系)</p>
<h2 id="Jupyter-源码"><a href="#Jupyter-源码" class="headerlink" title="Jupyter 源码"></a>Jupyter 源码</h2><p>Jupyter是基于Tornado框架开发的</p>
<p><a href="https://tornado-zh.readthedocs.io/zh/latest/guide/intro.html" target="_blank" rel="noopener">Tornado官方文档</a></p>
<p><code>tests</code>文件夹下都是用来测试的JS脚本,执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -m notebook.jstest # 测试所有JS脚本</span><br><span class="line">python3 -m notebook.jstest base/utils.js # 指定测试某个脚本</span><br></pre></td></tr></table></figure>
<p>第一次执行前需要安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g casperjs #phantomjs #slimerjs # 分别安装这三个</span><br></pre></td></tr></table></figure>
<p>运行后发现有两个模块的测试不成功,报错如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Dengs-MacBook-Pro% python3 -m notebook.jstest</span><br><span class="line"></span><br><span class="line">Test group: selenium</span><br><span class="line">Running tests with notebook directory &apos;/var/folders/wg/_3cvvz5n7955vdyv_d3g0t380000gn/T/tmplgo2n3_i&apos;</span><br><span class="line">No test file found in /Users/oliveds/Documents/Jupyter-Kernel/notebook/notebook/tests/selenium, terminating.</span><br><span class="line"></span><br><span class="line">Test group: mockextension</span><br><span class="line">Running tests with notebook directory &apos;/var/folders/wg/_3cvvz5n7955vdyv_d3g0t380000gn/T/tmp2o9m1atv&apos;</span><br><span class="line">Test file: /Users/oliveds/Documents/Jupyter-Kernel/notebook/notebook/tests/mockextension/index.js</span><br><span class="line">z</span><br><span class="line">^CInterrupted</span><br><span class="line">______________________________________________________________________</span><br><span class="line">Test suite completed for system with the following information:</span><br><span class="line">Python version: 3.7.2 (default, Feb 12 2019, 08:15:36) [Clang 10.0.0 (clang-1000.11.45.5)]</span><br><span class="line">sys.executable: /usr/local/opt/python/bin/python3.7</span><br><span class="line">Platform      : Darwin-18.2.0-x86_64-i386-64bit</span><br><span class="line"></span><br><span class="line">Tools and libraries available at test time:</span><br><span class="line">   casperjs phantomjs slimerjs</span><br><span class="line"></span><br><span class="line">Status: ERROR - 2 out of 5 test groups failed (selenium, mockextension). Took 61.624s.</span><br><span class="line"></span><br><span class="line">You may wish to rerun these, with:</span><br><span class="line">  python -m notebook.jstest selenium mockextension</span><br></pre></td></tr></table></figure>
<p><code>selenium</code>是找不到测试文件,<code>mockextension</code>是一直卡住被我强制<code>ctl+C</code>退出了.不知道是否是我这边安装的问题(也有可能是没写测试代码就不能测试,这个我以后再解决)</p>
<h2 id="源码结构"><a href="#源码结构" class="headerlink" title="源码结构"></a>源码结构</h2><p>我之前只用Django开发过一个比较简单的网页,主要都是按照教程follow the steps,所以并没有大型项目的开发经验.看到Jupyter Notebook的源码后,头很大😥连怎么找到需要的代码都不知道…所以打算不要着急,把基础知识补一补.</p>
<p><a href="https://docs.python-guide.org/writing/structure/" target="_blank" rel="noopener">https://docs.python-guide.org/writing/structure/</a></p>
<p>这个网页比较好地介绍了Python工程应该如何布局</p>
<p>但是看完之后还是没法看懂<code>Jupyter</code>的代码结构,可能是因为Jupyter是网页编程,并且用了很多别的模块,项目比较复杂吧🤷‍♀️</p>
<p>网页编程的话,我想我其实只需要知道按钮的执行函数就可以入手了,想起我之前编Django框架下的Python程序的时候,是对每个行为<code>def xxx</code>,然后关联到一个对应的<code>html</code>网页上.<code>Jupyter</code>这个工程中我没有看到大量的<code>html</code>文件<del>,可能是完全用<code>js</code>取代了<code>HTML</code>? <code>Correct me if I&#39;m wrong!</code></del>No,在<code>notebook/templates</code>下!</p>
<h3 id="CodeMirror"><a href="#CodeMirror" class="headerlink" title="CodeMirror"></a>CodeMirror</h3><blockquote>
<p> CodeMirror is a versatile text editor implemented in JavaScript for the browser. </p>
</blockquote>
<p>在JS中可以调用,作为代码编辑框,可以设置显示格式,规定粘贴选型,实现代码自动补全等等功能</p>
<p>官方文档: <a href="https://codemirror.net/doc/manual.html#usage" target="_blank" rel="noopener">https://codemirror.net/doc/manual.html#usage</a></p>
<h3 id="Babel"><a href="#Babel" class="headerlink" title="Babel"></a>Babel</h3><blockquote>
<p>Babel is a JavaScript compiler</p>
<p>Babel is a toolchain that is mainly used to convert ECMAScript 2015+ code into a backwards compatible version of JavaScript in current and older browsers or environments. </p>
</blockquote>
<p>官方文档: <a href="https://babeljs.io/docs/en/" target="_blank" rel="noopener">https://babeljs.io/docs/en/</a></p>
<p>主目录下的<code>./babelrc</code>是babel的configuration file</p>
<h3 id="Bower"><a href="#Bower" class="headerlink" title="Bower"></a>Bower</h3><p>网页的包管理器</p>
<blockquote>
<p>Bower can manage components that contain HTML, CSS, JavaScript, fonts or even image files. Bower doesn’t concatenate or minify code or do anything else - it just installs the right versions of the packages you need and their dependencies.</p>
</blockquote>
<p>官方文档: <a href="https://bower.io/" target="_blank" rel="noopener">https://bower.io/</a></p>
<h3 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h3><p>用来编译JavaScript,提前知晓代码是否能够正常运行的工具</p>
<blockquote>
<p>A pluggable and configurable linter tool for identifying and reporting on patterns in JavaScript. Maintain your code quality with ease.</p>
<p>JavaScript, being a dynamic and loosely-typed language, is especially prone to developer error. Without the benefit of a compilation process, JavaScript code is typically executed in order to find syntax or other errors. Linting tools like ESLint allow developers to discover problems with their JavaScript code without executing it.</p>
</blockquote>
<p>官方文档: <a href="https://eslint.org/docs/about/" target="_blank" rel="noopener">https://eslint.org/docs/about/</a></p>
<h3 id="Travis-CI"><a href="#Travis-CI" class="headerlink" title="Travis CI"></a>Travis CI</h3><p>GitHub的辅助工具,push后自动检查代码是否能够正常工作</p>
<p>持续集成: Continuous Integration solution</p>
<blockquote>
<p>Travis CI is a hosted, distributed continuous integration service used to build and test projects hosted at GitHub. Travis CI automatically detects when a commit has been made and pushed to a GitHub repository that is using Travis CI, and each time this happens, it will try to build the project and run tests. This includes commits to all branches, not just to the master branch.</p>
</blockquote>
<p>如何理解: <a href="https://stackoverflow.com/questions/22587148/trying-to-understand-what-travis-ci-does-and-when-it-should-be-used" target="_blank" rel="noopener">https://stackoverflow.com/questions/22587148/trying-to-understand-what-travis-ci-does-and-when-it-should-be-used</a></p>
<h3 id="AppVeyor-CI"><a href="#AppVeyor-CI" class="headerlink" title="AppVeyor CI"></a>AppVeyor CI</h3><p>类似Travis CI,也是持续集成工具,跑在Windows上</p>
<p>官网: <a href="https://www.appveyor.com/" target="_blank" rel="noopener">https://www.appveyor.com/</a></p>
<h3 id="CodeCov"><a href="#CodeCov" class="headerlink" title="CodeCov"></a>CodeCov</h3><p>有一个管理代码的工具,没仔细看了</p>
<blockquote>
<p> Improve your code review workflow and quality. Codecov provides highly integrated tools to group, merge, archive, and compare coverage reports.</p>
</blockquote>
<p><a href="https://codecov.io/" target="_blank" rel="noopener">https://codecov.io/</a></p>
<p>Python Egg</p>
<blockquote>
<p>The <code>.egg</code> file is a distribution format for Python packages. It’s just an alternative to a source code distribution or Windows <code>exe</code>. But note that for pure <code>Python</code>, the <code>.egg</code> file is completely cross-platform.</p>
<p>The <code>.egg</code> file itself is essentially a <code>.zip</code> file. If you change the extension to “<code>zip</code>”, you can see that it will have folders inside the archive.</p>
</blockquote>
<hr>
<p>已经确定源码都是在notebook文件夹下,那么下面就耐心地看一下每个文件做了什么吧…</p>
<h3 id="init-py"><a href="#init-py" class="headerlink" title="_init_.py"></a>_init_.py</h3><p>如果需要建立一个python模块让其他地方可以导入并且使用,就需要有这个文件,主要是为了防止包的重名?<code>Correct me if I&#39;m wrong</code></p>
<p>可以在里面<code>import xxx</code>或初始化对象,这样整个包都具有了这些内容,但通常不建议这样做,容易造成冗余</p>
<blockquote>
<p>The <code>__init__.py</code> files are required to make Python treat the directories as containing packages; this is done to prevent directories with a common name, such as <code>string</code>, from unintentionally hiding valid modules that occur later (deeper) on the module search path. In the simplest case, <code>__init__.py</code> can just be an empty file, but it can also execute initialization code for the package or set the <code>__all__</code> variable, described later.</p>
</blockquote>
<h3 id="main-py"><a href="#main-py" class="headerlink" title="_main_.py"></a>_main_.py</h3><p>通常Python都是直接执行一个<code>.py</code>文件如果想要直接执行一个包(文件夹),那么就会先执行<code>_main_.py</code>这个文件(后<code>_init_.py</code>再后其他文件)</p>
<hr>
<h1 id="修改Button功能"><a href="#修改Button功能" class="headerlink" title="修改Button功能"></a>修改Button功能</h1><ol>
<li><p>在<code>Chrome</code>中查看jupyter页面的<code>Elements</code>,找到<code>Run</code>按钮元素的名字为<code>run-cell-and-select-next</code></p>
<p><img src="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/web-pics/button-run.png" alt></p>
<p>我的想法是,按钮一定会关联到一个函数(点击按钮执行Python的一个函数/js脚本),所以我在工程(notebook)中搜索这个button的名字,试图找到关联的函数</p>
</li>
<li><p>定位到了<code>notebook/static/notebook/js/action.js</code> 这个js文件中定义了一堆actions,并规定了它们的Handler,以其中一个action为例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'run-cell'</span>:&#123;</span><br><span class="line">            cmd: i18n.msg._(<span class="string">'run selected cells'</span>),</span><br><span class="line">            help    : i18n.msg._(<span class="string">'run selected cells'</span>),</span><br><span class="line">            help_index : <span class="string">'bb'</span>,</span><br><span class="line">            handler : <span class="function"><span class="keyword">function</span> (<span class="params">env</span>) </span>&#123;</span><br><span class="line">                env.notebook.execute_selected_cells();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure>
<p>所以如果我现在规定一个按钮的action是<code>run-cell</code>,那么会调用的函数就是<code>execute_selected_cells()</code>.我查看一下这个函数,发现有两个该函数的声明,分别在<code>notebook/static/notebook/js/main.min.js</code>和<code>notebook/static/notebook/js/notebook.js</code></p>
<p>我看了一下两个文件中的代码,好像差不多,<code>可能main.min.js是提供给windows执行的代码?而notebook.js是Xus执行的?</code></p>
</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/13/Kubernetes/" rel="next" title="Kubernetes">
                <i class="fa fa-chevron-left"></i> Kubernetes
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/13/前后端培训/" rel="prev" title="前后端培训">
                前后端培训 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">OliveDS</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/OliveDS" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:dengs1996@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/OliveDS" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-csdn"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#引言"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IJAVA-Kernel-安装"><span class="nav-number">2.</span> <span class="nav-text">IJAVA Kernel 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#双-JDK安装"><span class="nav-number">2.1.</span> <span class="nav-text">(双)JDK安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IJAVA-Kernel-安装-1"><span class="nav-number">2.2.</span> <span class="nav-text">IJAVA Kernel 安装</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JVM-BaseKernel-使用"><span class="nav-number">3.</span> <span class="nav-text">JVM BaseKernel 使用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IPython-Kernel"><span class="nav-number">4.</span> <span class="nav-text">IPython Kernel</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JVM-BaseKernel"><span class="nav-number">5.</span> <span class="nav-text">JVM BaseKernel</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#INachornJS-Kernel"><span class="nav-number">6.</span> <span class="nav-text">INachornJS Kernel</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#INashornJS-java"><span class="nav-number">6.1.</span> <span class="nav-text">INashornJS.java</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NashornKernel-java"><span class="nav-number">6.2.</span> <span class="nav-text">NashornKernel.java</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MyKernel"><span class="nav-number">7.</span> <span class="nav-text">MyKernel</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#修改Kernel-Name"><span class="nav-number">7.1.</span> <span class="nav-text">修改Kernel Name</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用Eclipse开发"><span class="nav-number">7.2.</span> <span class="nav-text">用Eclipse开发</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ContractManager-使用"><span class="nav-number">8.</span> <span class="nav-text">ContractManager 使用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Jupyter-Notebook-开发"><span class="nav-number">9.</span> <span class="nav-text">Jupyter Notebook 开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Jupyter-架构"><span class="nav-number">9.1.</span> <span class="nav-text">Jupyter 架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jupyter-源码"><span class="nav-number">9.2.</span> <span class="nav-text">Jupyter 源码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#源码结构"><span class="nav-number">9.3.</span> <span class="nav-text">源码结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CodeMirror"><span class="nav-number">9.3.1.</span> <span class="nav-text">CodeMirror</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Babel"><span class="nav-number">9.3.2.</span> <span class="nav-text">Babel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bower"><span class="nav-number">9.3.3.</span> <span class="nav-text">Bower</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ESLint"><span class="nav-number">9.3.4.</span> <span class="nav-text">ESLint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Travis-CI"><span class="nav-number">9.3.5.</span> <span class="nav-text">Travis CI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AppVeyor-CI"><span class="nav-number">9.3.6.</span> <span class="nav-text">AppVeyor CI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CodeCov"><span class="nav-number">9.3.7.</span> <span class="nav-text">CodeCov</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#init-py"><span class="nav-number">9.3.8.</span> <span class="nav-text">_init_.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#main-py"><span class="nav-number">9.3.9.</span> <span class="nav-text">_main_.py</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#修改Button功能"><span class="nav-number">10.</span> <span class="nav-text">修改Button功能</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">OliveDS</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'uaU7K98rSYcLih6bDPXI5vbf-gzGzoHsz',
        appKey: 'lfonkoBe1cGLNBLsjTuWaae9',
        placeholder: '请给菜鸡小码农一点意见和建议吧ε٩(๑> ₃ <)۶з',
        avatar:'identicon',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("uaU7K98rSYcLih6bDPXI5vbf-gzGzoHsz", "lfonkoBe1cGLNBLsjTuWaae9");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
