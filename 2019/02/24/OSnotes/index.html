<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/olive-appletouch.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/olive-logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="This is my notes on OS course, if there’s any kind of privacy issues or legal problems, please contact me to take it down. 引言Course Introduction operating systems advanced class会比本科的操作系统更难，进阶建议本科没学过操作">
<meta property="og:type" content="article">
<meta property="og:title" content="操作系统高级课程-笔记">
<meta property="og:url" content="https://oliveds.github.io/2019/02/24/OSnotes/index.html">
<meta property="og:site_name" content="OliveDS&#39;s Study Bar">
<meta property="og:description" content="This is my notes on OS course, if there’s any kind of privacy issues or legal problems, please contact me to take it down. 引言Course Introduction operating systems advanced class会比本科的操作系统更难，进阶建议本科没学过操作">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/20151026165444864.bmp?q-sign-algorithm=sha1&q-ak=AKIDcfowjZ3QQXxQLOuGEQfKgF4yslRo26Lb&q-sign-time=1551764724;1551766524&q-key-time=1551764724;1551766524&q-header-list=&q-url-param-list=&q-signature=ed134d0e138d05a9b8fcec7a644c4100aad093ac&x-cos-security-token=d726e95e40868c76ff1bff29d38c7b20dca1121610001">
<meta property="og:image" content="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/20151026170356243.bmp?q-sign-algorithm=sha1&q-ak=AKIDy3EGv5wi5qyfi9aAjBnDCkiqKixDuFqK&q-sign-time=1551764756;1551766556&q-key-time=1551764756;1551766556&q-header-list=&q-url-param-list=&q-signature=482117859aec765ff9e3c380b8f066f8904eeeb2&x-cos-security-token=c7cc50ed43f05fe4351fc5ef616bd68f455dc34a10001">
<meta property="og:updated_time" content="2019-03-11T10:07:04.894Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="操作系统高级课程-笔记">
<meta name="twitter:description" content="This is my notes on OS course, if there’s any kind of privacy issues or legal problems, please contact me to take it down. 引言Course Introduction operating systems advanced class会比本科的操作系统更难，进阶建议本科没学过操作">
<meta name="twitter:image" content="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/20151026165444864.bmp?q-sign-algorithm=sha1&q-ak=AKIDcfowjZ3QQXxQLOuGEQfKgF4yslRo26Lb&q-sign-time=1551764724;1551766524&q-key-time=1551764724;1551766524&q-header-list=&q-url-param-list=&q-signature=ed134d0e138d05a9b8fcec7a644c4100aad093ac&x-cos-security-token=d726e95e40868c76ff1bff29d38c7b20dca1121610001">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://oliveds.github.io/2019/02/24/OSnotes/">





  <title>操作系统高级课程-笔记 | OliveDS's Study Bar</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">OliveDS's Study Bar</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一个小小码农的学习分享</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://oliveds.github.io/2019/02/24/OSnotes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="OliveDS">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OliveDS's Study Bar">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">操作系统高级课程-笔记</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-24T08:59:09+08:00">
                2019-02-24
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2019-03-11T18:07:04+08:00">
                2019-03-11
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Lectures/" itemprop="url" rel="index">
                    <span itemprop="name">Lectures</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/24/OSnotes/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/02/24/OSnotes/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/24/OSnotes/" class="leancloud_visitors" data-flag-title="操作系统高级课程-笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>This is my notes on OS course, if there’s any kind of privacy issues or legal problems, please contact me to take it down.</p>
<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><h2 id="Course-Introduction"><a href="#Course-Introduction" class="headerlink" title="Course Introduction"></a>Course Introduction</h2><blockquote>
<p>operating systems advanced class<br>会比本科的操作系统更难，进阶<br>建议本科没学过操作系统的同学选修<br>研究生阶段 - 补充短板，打好基础</p>
</blockquote>
<h3 id="系统能力培养"><a href="#系统能力培养" class="headerlink" title="系统能力培养"></a>系统能力培养</h3><p>程序性开发能力→系统性设计能力<br><strong>解决复杂工程问题的基本能力</strong><br>综合能力 &gt;&gt; coding<br>系统：若干相互关联的部件有机结合在一起，具有一定功能。</p>
<h4 id="三个层次："><a href="#三个层次：" class="headerlink" title="三个层次："></a>三个层次：</h4><ol>
<li>本课：基础系统</li>
<li>专门系统 计算机领域系统</li>
<li>应用系统 </li>
</ol>
<h4 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h4><p>缺乏整体系统整体能力，缺少知识关联，实践能力差</p>
<h3 id="教学目的："><a href="#教学目的：" class="headerlink" title="教学目的："></a>教学目的：</h3><ol>
<li>深入理解操作系统：阅读源码<br>1.1. 全局结构<br>1.2. 内部工作方式<br>1.3. 数据结构和算法<br>1.4. 发现问题，解决方案<br>1.5. 典型技术和应用<br>e.g. 数据结构-进程控制块PCB<blockquote>
<p>PCB包括：（以Linux为例）<br>1）进程标识符（内部，外部）<br>2）处理机的信息（通用寄存器，指令计数器，PSW，用户的栈指针）。<br>3）进程调度信息（进程状态，进程的优先级，进程调度所需的其它信息，事件）<br>4）进程控制信息（程序的数据的地址，资源清单，进程同步和通信机制，链接指针）<br>能够提出问题、解决方案、折中</p>
</blockquote>
</li>
<li>动手完成一个很小的模拟操作系统</li>
<li>提高总结凝练的能力</li>
</ol>
<h3 id="教学计划："><a href="#教学计划：" class="headerlink" title="教学计划："></a>教学计划：</h3><p>进程线程，运行机制，同步机制，虚存机制，文件系统<br>XV6源代码阅读<br>实例：Windows，Linux<br>实验 Nachos<br>华文慕课</p>
<h3 id="课程环节："><a href="#课程环节：" class="headerlink" title="课程环节："></a>课程环节：</h3><p>Nachos实习笔试(5.20 开卷-编程+简答)、期末Nachos实习面测(选)，期末笔试<br>分值：<br>Nachos实习报告24(格式规范、按时提交、内容质量，注重个人心得体会，注重实作) Nachos笔试10 (可选面测弥补) XV6代码阅读报告16 课堂参与10<br>期末40闭卷<br>创新实践、特色实践+1~10 (可选题目，加到平时分)</p>
<h3 id="参考书："><a href="#参考书：" class="headerlink" title="参考书："></a>参考书：</h3><p>教材（选用哪一本都可以）<br>•Modern Operating System Andrew S. Tanenbaum<br>•现代操作系统（第4版）陈向群等译机械工业出版社<br>相关参考书目<br>•Windows内核原理与实现潘爱民电子工业出版社<br>•Linux内核设计与实现[美] R.Love著，陈莉君译机械工业出版社<br>•深入理解计算机系统[美]R.E. Bryant等著龚奕利雷迎春译机械工业出版社</p>
<h2 id="Nachos操作系统"><a href="#Nachos操作系统" class="headerlink" title="Nachos操作系统"></a>Nachos操作系统</h2><p>UC Berkeley教学用操作系统 使用C++编写，也可以用java（改写5.0j）PintOS（C,可运行于x86-硬件需要C语言）<br>使用3.4稳定版本 latest 4.1<br>（JOS by MIT 也是教学用操作系统）<br>不真正运行于硬件，模拟了一个==MIPS模拟器==<br>可拓展功能，可移植到其它架构（可以真正运行于硬件上）</p>
<h3 id="e-g-线程切换"><a href="#e-g-线程切换" class="headerlink" title="e.g. 线程切换"></a>e.g. 线程切换</h3><p>（Nachos中只有线程）<del>实际只是命名问题</del><br>关键：保存和恢复线程的<strong>上下文环境(context)</strong>(使用的寄存器-CPU中) e.g. PC, PSW (程序状态字/程序状态寄存器, Program Status Word)…<br>使用<strong>汇编</strong>编写完成-与硬件打交道需要汇编，高级语言难以实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movl x,x #保存现场</span><br><span class="line">movl x,x #恢复现场</span><br></pre></td></tr></table></figure></p>
<h3 id="Nachos体系结构"><a href="#Nachos体系结构" class="headerlink" title="Nachos体系结构"></a>Nachos体系结构</h3><p>Linux宿主机上的一个进程，一个<strong>应用程序</strong><br>分为3层：<strong>MIPS模拟器，Nachos操作系统，Nachos应用程序</strong>（C程序，在x86平台上交叉编译-MIPS指令集）<br>不涉及真正硬件）底层为Host OS和真正硬件</p>
<h3 id="实习要求"><a href="#实习要求" class="headerlink" title="实习要求"></a>实习要求</h3><p>0环境+6+7,8附加</p>
<h3 id="Nachos系统源代码树结构"><a href="#Nachos系统源代码树结构" class="headerlink" title="Nachos系统源代码树结构"></a>Nachos系统源代码树结构</h3><p>见PPT0 page31</p>
<h2 id="XV6"><a href="#XV6" class="headerlink" title="XV6"></a>XV6</h2><p>能够真正运行于硬件的简单操作系统，基于x86架构，Unix-like<br>本课需要阅读源代码，小组每周讨论</p>
<h2 id="课程目标"><a href="#课程目标" class="headerlink" title="课程目标"></a>课程目标</h2><h3 id="典型名词术语"><a href="#典型名词术语" class="headerlink" title="典型名词术语"></a>典型名词术语</h3><h4 id="高速缓存-vs-TLB-vs-块高速缓存-Linux-文件缓存-Windows"><a href="#高速缓存-vs-TLB-vs-块高速缓存-Linux-文件缓存-Windows" class="headerlink" title="高速缓存 vs TLB vs 块高速缓存(Linux)/文件缓存(Windows)"></a>高速缓存 vs TLB vs 块高速缓存(Linux)/文件缓存(Windows)</h4><ol>
<li>高速缓存<br>CPU Cache(高速缓存) 分级为 L1 L2 L3<br>（多核CPU中，可能每核具有L1 L2，L3共用 ==correct me if I’m wrong==）<br>依次命中</li>
<li>TLB<br>= Translation Lookaside Buffer 传输后备缓冲器<br>是<strong>内存管理单元MMU用于改进虚拟地址到物理地址转换速度的缓存，位于MMU中</strong><br>MMU中包含页表地址寄存器，记录了页表本身的存放位置，位于CPU中；<strong>页表位于物理内存中</strong>，由很多页表项组成，页表项并不是包含具体物理地址的单元，此页表项只是给出页表描述符的地址，描述符当中给出物理地址的部分内容，再加上虚拟地址当中的部分内容就得到了具体的物理地址；TLB位于MMU中。<blockquote>
<p>MMU是，在中央处理器CPU中用来管理虚拟存储器、物理存储器的控制线路，同时也负责虚拟地址映射为物理地址，以及提供硬件机制的内存访问授权，多用户多进程操作系统。</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>在计算机技术中，把内存中的程序段复制回辅存的做法叫做“换出”，而把辅存中程序段映射到内存的做法叫做“换入”。经过不断有目的的换入和换出，处理器就可以运行一个大于实际物理内存的应用程序了。或者说，处理器似乎是拥有了一个大于实际物理内存的内存空间。于是，这个存储空间叫做<strong>虚拟内存空间</strong>，而把真正的内存叫做实际物理内存，或简称为<strong>物理内存</strong>。<br>一个应用程序从编写到被执行，需要进行两次映射。第一次是映射到虚拟内存空间，<strong>第二次时映射到物理内存空间</strong>。在计算机系统中，第两次映射的工作是由硬件和软件共同来完成的。承担这个任务的<strong>硬件部分叫做存储管理单元MMU</strong>，软件部分就是操作系统的内存管理模块了。<br>在映射工作中，为了记录程序段占用物理内存的情况，操作系统的内存管理模块需要建立一个表格，该表格以虚拟地址为索引，记录了程序段所占用的物理内存的物理地址。这个虚拟地址/物理地址记录表，即<strong>页表</strong>便是存储管理单元MMU把虚拟地址转化为实际物理地址的依据。<br>Yngz_Miao <a href="https://blog.csdn.net/qq_38410730/article/details/81036768" target="_blank" rel="noopener">https://blog.csdn.net/qq_38410730/article/details/81036768</a> </p>
</blockquote>
<ol start="3">
<li><p>块高速缓存<br>为了解决读取物理存储（盘）较慢的问题，在内存中设置块缓存，存储经常读取的磁盘内容。==correct me if i’m wrong==</p>
<blockquote>
<p>与内存页相比，块不仅比较小（大多数情况下），而且长度可变的，依赖于使用的块设备（或文件系统）。随着日渐倾向于使用基于页操作实现的通用文件存取方法，块缓存作为中枢系统缓存的重要性已经逐渐失去。主要的缓存任务现在由页缓存承担。另外，基于块的I/O的标准数据结构，现在已经不再是缓冲区，而是struct bio结构。<br>bullbat <a href="https://blog.csdn.net/bullbat/article/details/7306178" target="_blank" rel="noopener">https://blog.csdn.net/bullbat/article/details/7306178</a> </p>
</blockquote>
</li>
<li><p>Web Page Cache<br>同样地，Web Server中，网页存储在磁盘中，读取速度较慢。在内存中开辟 Web page cache存取访问量大的网页。==correct me if i’m wrong==</p>
<h4 id="其它典型名词术语-E-G"><a href="#其它典型名词术语-E-G" class="headerlink" title="其它典型名词术语 E.G."></a>其它典型名词术语 E.G.</h4><p>Multiprogramming<br>PCB<br>Starvation 进程调度-饥饿算法<br>Page replacement<br>Time-sharing<br>Context switch<br>Preemptive<br>Temporal locality<br>Booting<br>Thread<br>Priority<br>Programmed I/O<br>Protection<br>Multithreading<br>Deadlock<br>DMA<br>Privileged instruction<br>Scheduling<br>Wait-for graph<br>Buffer<br>Exception<br>Synchronization<br>Virtual memory<br>RAID<br>Fault<br>Data race<br>Paging<br>Disk cache<br>System call<br>Mutual exclusion<br>Virtual address<br>File<br>Interrupt<br>Critical section<br>Swapping<br>Directory<br>Process<br>Atomic operation<br>Page table<br>Device driver<br>Execution state<br>Lock<br>TLB<br>Pagefault<br>Address space<br>Semaphore<br>Shared address space<br>Spatial locality</p>
<h4 id="回顾知识点"><a href="#回顾知识点" class="headerlink" title="回顾知识点"></a>回顾知识点</h4><p>•存储器层次结构<br>•局部性原理<br>Cache，在内存缓存磁盘块，Web Cache<br>•异常控制流<br>中断、陷阱、故障、系统调用、内核/用户模式<br>•进程、线程<br>•并发：同步与通信机制、死锁<br>•虚存<br>页表、TLB、地址翻译（地址转换）、Page fault<br>内存映射</p>
<h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><h3 id="地位"><a href="#地位" class="headerlink" title="地位"></a>地位</h3><p>应用程序 👈终端用户<br>系统功能调用 👈应用软件设计者<br>操作系统        👈应用软件设计者<br>计算机硬件 👈操作系统设计者</p>
<h3 id="名称"><a href="#名称" class="headerlink" title="名称"></a>名称</h3><p>软件越来越重要，从Monitor(Supervisor)→Operating System</p>
<h3 id="Helloworld-程序运行时操作系统作用"><a href="#Helloworld-程序运行时操作系统作用" class="headerlink" title="Helloworld 程序运行时操作系统作用"></a>Helloworld 程序运行时操作系统作用</h3></li>
<li><p>用户告诉操作系统执行HelloWorld程序<br>键盘输入指令(./filename) / 可视化界面下双击执行？==correct me if i’m wrong==</p>
</li>
<li><p>操作系统：找到helloworld程序的相关信息，检查其类型是否是<strong>可执行文件</strong>；并通过程序首部信息，确定<strong>代码和数据</strong>在可执行文件中的位置并计算出对应的<strong>磁盘块地址</strong><br>Linux/Unix 中可执行文件为 elf 类型（Windows中为PE）</p>
<blockquote>
<p>ELF(Executable and Linking Format)是一种<strong>对象文件的格式</strong>，用于定义不同类型的对象文件(Object files)中都放了什么东西、以及都以什么样的格式去放这些东西。它自最早在 System V 系统上出现后，被 xNIX 世界所广泛接受，作为缺省的二进制文件格式来使用。可以说，ELF是构成众多xNIX系统的基础之一。<br>ELF文件有三种类型：</p>
<ul>
<li>可重定位的对象文件(Relocatable file) 由<strong>汇编器汇编生成的 .o 文件</strong></li>
<li>可执行的对象文件(Executable file) <strong>可执行应用程序</strong></li>
<li>可被共享的对象文件(Shared object file)<strong> 动态库文件，也即 .so 文件</strong></li>
</ul>
</blockquote>
</li>
</ol>
<blockquote>
<p>PE是目前Windows平台上主流的可执行文件格式，包括常见的可执行程序EXE文件、动态链接库DLL文件等。</p>
</blockquote>
<p>Linux/Unix 文件开头几个字节为Magic Number，在每种特定文件类型中是唯一的</p>
<blockquote>
<p>Magic numbers are the first few bytes of a file which are unique to a particular file type. </p>
<ol start="3">
<li>操作系统：创建一个新进程，将HelloWorld可执行文件映射到该进程结构，表示由该进程执行helloworld程序。<br>创建数据结构(PCB)并填写==correct me if i’m wrong==</li>
</ol>
</blockquote>
<p>(<strong>3.5. 调度程序</strong>-看不见的手<br>进程创建成功后控制权属于调度程序，等待调度后才可执行）</p>
<ol start="4">
<li><p>(调度程序选中HelloWorld后) 操作系统：为helloworld程序设置cpu上下文环境，并跳到程序开始处。</p>
</li>
<li><p>执行helloworld程序的第一条指令，发生<strong>缺页异常</strong><br>程序未被读入内存中</p>
</li>
</ol>
<p>6操作系统：分配一页物理内存，并将代码从磁盘读入内存，然后继续执行helloworld程序</p>
<p>7helloword程序执行puts函数（系统调用），在显示器上写一字符串</p>
<p>8操作系统：找到要将字符串送往的显示设备，通常设备是由一个进程控制的，所以，操作系统将要写的字符串送给该进程</p>
<p>9操作系统：控制设备的进程告诉设备的窗口系统，它要显示该字符串，窗口系统确定这是一个合法的操作，然后将字符串转换成像素，将像素写入设备的存储映像区</p>
<p>10视频硬件将像素转换成显示器可接收和一组控制数据信号</p>
<p>11显示器解释信号，激发液晶屏</p>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><p>复习本课内容，下载XV6源码，完成Lab0（环境搭建，阅读源码，编写程序）</p>
<h1 id="处理器调度"><a href="#处理器调度" class="headerlink" title="处理器调度"></a>处理器调度</h1><h2 id="三个层次"><a href="#三个层次" class="headerlink" title="三个层次"></a>三个层次</h2><p><img src="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/20151026165444864.bmp?q-sign-algorithm=sha1&amp;q-ak=AKIDcfowjZ3QQXxQLOuGEQfKgF4yslRo26Lb&amp;q-sign-time=1551764724;1551766524&amp;q-key-time=1551764724;1551766524&amp;q-header-list=&amp;q-url-param-list=&amp;q-signature=ed134d0e138d05a9b8fcec7a644c4100aad093ac&amp;x-cos-security-token=d726e95e40868c76ff1bff29d38c7b20dca1121610001" alt="3种调度位置"></p>
<ol>
<li><p>短程调度(进程调度)</p>
<p>从<strong>就绪队列(内存</strong>用户态区)调度到<strong>CPU</strong></p>
<p><strong>CPU调度</strong>是短程调度-选进程,送入CPU-最底层</p>
</li>
<li><p>中程调度(交换调度)</p>
<p>调整进程在内存中的存在数量和时机,将处于<strong>外存交换区</strong>中的就绪状态或等待状态的进程调入<strong>内存</strong>,或把处于内存就绪状态或内存等待状态的进程交换到外存交换区</p>
<p>一般是挂起状态进程的调度</p>
</li>
<li><p>长程调度(作业调度,高级调度)</p>
<p>从<strong>外存</strong>(可能)批量,为其建立进程,调度到<strong>内存</strong></p>
<p><img src="https://oliveds-1258728895.cos.ap-beijing.myqcloud.com/20151026170356243.bmp?q-sign-algorithm=sha1&amp;q-ak=AKIDy3EGv5wi5qyfi9aAjBnDCkiqKixDuFqK&amp;q-sign-time=1551764756;1551766556&amp;q-key-time=1551764756;1551766556&amp;q-header-list=&amp;q-url-param-list=&amp;q-signature=482117859aec765ff9e3c380b8f066f8904eeeb2&amp;x-cos-security-token=c7cc50ed43f05fe4351fc5ef616bd68f455dc34a10001" alt="三级调度"></p>
</li>
</ol>
<h2 id="处理器调度-1"><a href="#处理器调度-1" class="headerlink" title="处理器调度"></a>处理器调度</h2><p>基本认识:按一定调度算法,选一个,给CPU使用权</p>
<p>若无就绪进程,系统空闲进程/闲逛进程/idle进程,不属于用户,执行空指令-<em>占座</em>-CPU周而复始运作</p>
<p>调度程序:内核函数,决策-挑选就绪进程</p>
<ol>
<li>What 调度算法</li>
<li>When 调度时机</li>
<li>W</li>
</ol>
<h3 id="CPU调度时机"><a href="#CPU调度时机" class="headerlink" title="CPU调度时机"></a>CPU调度时机</h3><p>事件:进程运行过程中有很多事件</p>
<p>事件发生后→进程暂停→硬件机制响应→进入操作系统-<strong>内核</strong>处理相应事件→处理完后-格局变化(可能进程状态改变,可能创建了新进程)</p>
<p>4种调度时机-总结:内核对中断/异常/系统调用处理后返回用户态时</p>
<h3 id="进程切换"><a href="#进程切换" class="headerlink" title="进程切换"></a>进程切换</h3><p>可能是刚刚暂停执行的进程/新进程</p>
<p>被换入的进程:事件发生后,当前进程的内容context被放入内核栈(系统栈)中-栈是临时存储,PCB是长久存储-数据结构</p>
<p>若恢复该进程,从栈中弹出,否则若切换另一个进程,将栈中内容放入PCB中</p>
<p>新选入进程的上下文context在PCB中,若被选中,将其内容取出</p>
<ol>
<li><p>切换全局页目录</p>
<p>每个进程有不同地址空间,加载新地址空间</p>
<p>全局页目录:指向地址空间的物理地址的指针(Intel中CR3)</p>
</li>
<li><p>切换内核栈和上下文</p>
</li>
</ol>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>(A下CPU,B上CPU)</p>
<ol>
<li>保存进程A上下文到PCB中</li>
<li>更新A的PCB</li>
<li>将A移到合适对垒</li>
</ol>
<h3 id="上下文切换开销"><a href="#上下文切换开销" class="headerlink" title="上下文切换开销"></a>上下文切换开销</h3><p>寄存器存取时间</p>
<ol>
<li><p>直接开销</p>
<p>内核完成切换的CPU时间:保存恢复寄存器,切换地址空间</p>
<p>(不同指令的代价不同-时间也不同</p>
</li>
<li><p>间接开销</p>
<p>高速缓存cache,缓冲区缓存buffer cache,TLB(进程页表的部分表项)清空</p>
<p>肯定不会命中,所以开销大</p>
<p><strong>了解Cache工作原理</strong></p>
</li>
</ol>
<h3 id="调度算法"><a href="#调度算法" class="headerlink" title="调度算法"></a>调度算法</h3><p>不同操作系统-不同难易-需要考虑完成的任务不同</p>
<p>需要在<strong>PCB</strong>中记录跟CPU调度有关的信息-用于调度</p>
<h4 id="优先级和优先数"><a href="#优先级和优先数" class="headerlink" title="优先级和优先数"></a>优先级和优先数</h4><p>优先数并不一定是越大越高,只是指标,所以一般说优先级-是更显著的指标</p>
<p>优先级:动态-过程中动态变化;静态-运行过程中不变</p>
<h4 id="就绪队列组织"><a href="#就绪队列组织" class="headerlink" title="就绪队列组织"></a>就绪队列组织</h4><h4 id="抢占-amp-非抢占"><a href="#抢占-amp-非抢占" class="headerlink" title="抢占&amp;非抢占"></a>抢占&amp;非抢占</h4><p>抢占:有更高优先级就绪,系统就强行剥夺CPU</p>
<p>靠中断-异常-系统调用,实际就是切换 具体是由调度程序执行</p>
<p>非抢占:进程不想下CPU就可以不下CPU</p>
<h4 id="I-O密集型-CPU密集型进程"><a href="#I-O密集型-CPU密集型进程" class="headerlink" title="I/O密集型/CPU密集型进程"></a>I/O密集型/CPU密集型进程</h4><p>一般操作系统对IO密集型更友好</p>
<h4 id="时间片"><a href="#时间片" class="headerlink" title="时间片"></a>时间片</h4><p>长/短 固定/可变</p>
<h3 id="不同调度算法"><a href="#不同调度算法" class="headerlink" title="不同调度算法"></a>不同调度算法</h3><ol>
<li><p>短作业优先SJF</p>
<p>可以抢占(有更短的立刻上CPU)/非抢占(在就绪对列中选短)-各有利弊</p>
<p><strong>所以进程同时可运行时</strong>SJF可得到最短平均等待时间</p>
</li>
<li><p>最高响应比优先HRRN</p>
<p>计算响应比R,抢占+非抢占折中</p>
</li>
<li><p>时间片轮转RR</p>
<p>周期性切换-时间片</p>
<p>时间片长短-</p>
<p>对不同大小进程-有利</p>
<p>对相同大小的进程(2*100ms)-切换失去意义: 平均为199.5ms;若FCFS则平均150ms</p>
</li>
<li><p>虚拟轮转VIRTUAL RR</p>
<p>原本:时间片到-回到就绪;等待IO-回到等待队列-IO好了之后回到就绪队列</p>
<p>优待IO型进程(主动放弃CPU),将IO等待的进程专开一个队列,先从这个队列中选择进程上CPU(认为可能还会主动放弃CPU</p>
</li>
<li><p>最高优先级</p>
<p>系统&gt;用户</p>
<p>前台&gt;后台</p>
<p>IO密集&gt;CPU密集</p>
<p>静态/动态优先级</p>
<p><strong>饥饿问题</strong></p>
<p>可能会<strong>优先级反转</strong></p>
<h4 id="优先级反转-反置"><a href="#优先级反转-反置" class="headerlink" title="优先级反转/反置"></a>优先级反转/反置</h4><p>抢占式会出现</p>
<p>L进入临界区操作(原语),被抢占,但是临界区中不可打断,因此H被阻塞,M反而上CPU执行,若M为CPU密集,LR都不能执行</p>
<p>e.g. 美国火星探测器天气预报为M,地面重启系统</p>
<h4 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h4><ol>
<li>优先级天花板协议</li>
<li>优先级继承:低优先级提升</li>
<li>使用中断禁止-低优先级临界区中不可被打断</li>
</ol>
</li>
<li><p>多级队列</p>
<h4 id="多级反馈队列"><a href="#多级反馈队列" class="headerlink" title="多级反馈队列"></a>多级反馈队列</h4><p><strong>重点</strong></p>
<p>多个就绪队列-级别依次降低,进队都是进第一个,用完时间片下CPU后下降一级;由于阻塞下CPU会原级队列(可以队首/队尾),重上CPU时上次时间片的处理(可以保留/抛弃)(均是设计者对IO型的友好程度)</p>
<p><strong>总是对IO密集型友好</strong></p>
<p>不同级队列时间片长度不同,级别高-时间片短</p>
<p>优先调第一级</p>
<p>各级队列按<strong>时间片轮转</strong></p>
</li>
</ol>
<ol start="7">
<li>最短进程≈段作业</li>
</ol>
<h4 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h4><p>最短剩余时间优先-最适合此例</p>
<h2 id="典型系统"><a href="#典型系统" class="headerlink" title="典型系统"></a>典型系统</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>很像 多级反馈队列</p>
<p>时间配额≈时间片,大小可变</p>
<p>区别多级反馈队列-其队列是按照进程优先级分配的</p>
<h4 id="线程优先级"><a href="#线程优先级" class="headerlink" title="线程优先级:"></a>线程优先级:</h4><ol>
<li><p>实时优先级</p>
<p>不可变</p>
</li>
</ol>
<h4 id="调度策略"><a href="#调度策略" class="headerlink" title="调度策略:"></a>调度策略:</h4><ol>
<li><p>主动切换</p>
<p>主动转到阻塞态</p>
</li>
<li><p>抢占</p>
<p>高优先级的从阻塞态中唤醒-抢占</p>
<p>则低优先级被强占的回到<strong>原</strong>优先级队列<strong>队首</strong>,若实时优先级,重置完整配额;否则执行其剩余时间</p>
</li>
<li></li>
</ol>
<h4 id="优先级提升-amp-时间配额调整"><a href="#优先级提升-amp-时间配额调整" class="headerlink" title="优先级提升&amp;时间配额调整"></a>优先级提升&amp;时间配额调整</h4><p>漏洞/瑕疵:饥饿等问题</p>
<ol>
<li><p>IO操作完成</p>
<p>提升值写在文件中</p>
<p>且时间配额每次-1</p>
</li>
<li><p>饥饿线程</p>
<p>排队&gt;300时间周期 平衡集管理器(还有其他工作)1s写一次,扫描一次就绪队列,将优先级提到最高15,时间配额为正常值*4,用完时间配额后优先级恢复原状</p>
</li>
</ol>
<h3 id="Linux-CFS"><a href="#Linux-CFS" class="headerlink" title="Linux CFS"></a>Linux CFS</h3><h1 id="中断-异常"><a href="#中断-异常" class="headerlink" title="中断/异常"></a>中断/异常</h1><p>态: </p>
<p>用户态/内核态</p>
<p>在x86中对应R0/R3(操作系统只需要两个,可能虚拟机等需要…)</p>
<p>中断向量表:</p>
<p>操作系统</p>
<ul>
<li>对下 依据硬件 物理机器界面</li>
<li>对上 提供接口 虚拟机器界面</li>
</ul>
<h2 id="异常控制流-ECF"><a href="#异常控制流-ECF" class="headerlink" title="异常控制流 ECF"></a>异常控制流 ECF</h2><p>指令上CPU后就会顺序执行,传统程序都是顺序的,后来加入分支/循环-均属于异常控制流,再后来加入函数调用-就是控制流改变</p>
<p>ECF是使整个系统转起来的关键,理解整个系统如何工作</p>
<p>用户应用程序不断调用OS(系统调用)完成任务,在再返回</p>
<p>异常/中断有区别</p>
<h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><p>平时声明的变量是内存-用寄存器更快</p>
<p>寄存器:用户可见/控制和状态(仅OS可用</p>
<p>硬件机制:防止OS具有所有权限? CPU需要支持特权状态(硬件机制)</p>
<p>CPU的不同状态2/3/4 PSW中的一位 </p>
<p>e.g. x86中EFLAGS寄存器 IO PL记录特权级, IF TF辅助位</p>
<p>操作系统只需要两个态:用户态,内核态</p>
<p>开关中断,内存清零,修改程序状态字都是特权指令</p>
<p><strong>仿管指令=陷入指令(maybe int/trap/syscall/…)</strong>,提供给用户程序的接口,用于调用OS的功能重要但是都需要访问? 非特权指令</p>
<h2 id="状态转换"><a href="#状态转换" class="headerlink" title="状态转换"></a>状态转换</h2><p><strong>中断/异常/陷入机制</strong> 用户态进入内核态的<strong>唯一</strong>路径</p>
<p>调度(决定是否需要换状态),<strong>设置程序状态字PSW</strong> 用内核态回用户态</p>
<h2 id="中断-异常机制"><a href="#中断-异常机制" class="headerlink" title="中断/异常机制"></a>中断/异常机制</h2><ul>
<li><p>中断,为了支持CPU和设备之间的并行操作(CPU启动设备后,设备可以独立工作</p>
</li>
<li><p>异常:CPU执行指令时本身出现的问题,<strong>系统调用,page fault,…</strong></p>
</li>
</ul>
<p>(也可能分别叫外中断/内中断)</p>
<p>通过硬件与软件结合实现</p>
<p>现在应该叫<strong>中断/异常机制</strong> CPU对系统发生的某个事件作出的一种反应,保留现场,自动转去(<strong>硬件</strong>的机制实现-OS与硬件紧密结合的约定)执行相应的事件的处理程序,处理完后返回<del>断点继续执行</del>调度,在以后某个时刻,等待被调度上后继续执行</p>
<h3 id="中断"><a href="#中断" class="headerlink" title="中断"></a>中断</h3><p>陷入trap: 返回到下一条</p>
<p>故障fault: 返回原指令?</p>
<p>执行完一条指令,(会对中断进行检查,若有中断将中断码送入PSW相应位,设置中断向量),在响应下一条指令前-响应中断,响应后(被重新调度后)回到下一条指令</p>
<h3 id="中断向量"><a href="#中断向量" class="headerlink" title="中断向量"></a>中断向量</h3><p>内存单元,放入中断处理程序的入口地址和程序运行所需的处理机状态字,指向一段对应的中断处理程序</p>
<p>硬件完成-按中断码,找中断向量表(一般在内存低地址位置-硬件知晓)(linux中系统调用在128)</p>
<h3 id="中断响应"><a href="#中断响应" class="headerlink" title="中断响应"></a>中断响应</h3><p>栈分为 用户栈,内核栈-只有一个栈指针,出于什么态就指向哪里</p>
<p>硬件将中断先放入中断装置中,CPU在执行完指令后检查中断,</p>
<p>硬件保存现场(发生中断时,硬件将PSW和PC推入栈中,其他的由软件负责推入栈)</p>
<p>硬件根据中断码查表,PC变为处理程序的入口地址,把中断处理程序…硬件将CPU控制权交给中断处理程序 </p>
<p>中断处理程序由<strong>软件</strong>(前面都是硬件)完成</p>
<p>…</p>
<h3 id="中断处理程序"><a href="#中断处理程序" class="headerlink" title="中断处理程序"></a>中断处理程序</h3><p>(设计OS时就编写好的)</p>
<p>保存相关寄存器信息(堆栈),分析原因(根据状态码),执行处理,恢复现场继续执行(要等调度后,若直接调度到-从栈中取/若没被调度,放入PCB)</p>
<p>I/O中断:正常(完成)/异常(错误)</p>
<h2 id="x86的中断处理"><a href="#x86的中断处理" class="headerlink" title="x86的中断处理"></a>x86的中断处理</h2><p>中断:硬件信号引发的 <strong>有中断码</strong>,异步处理</p>
<p>异常:指令执行引发的 <strong>无编码</strong>,但x86中对有些异常会产生硬件出错码</p>
<p>中断向量/中断描述符/门描述符(-linux,只用中断门()进来后禁止中断,关门)&amp;陷阱门(不会关门))都是数据结构,相似东西</p>
<p>系统调用:异常的一种,用户态进入内核态的唯一入口</p>
<p>保护模式:寻址-全局描述符表中段描述符中的基地址+中断描述符中(16+16)偏移量???</p>
<h2 id="系统调用"><a href="#系统调用" class="headerlink" title="系统调用"></a>系统调用</h2><p>用户编程时可以调用的操作系统的功能,从用户态-&gt;内核态</p>
<p>应用程序可以直接调系统调用,也可以通过库函数/API调用系统调用</p>
<p>内核函数:可能对应多个系统调用</p>
<p>e.g. printf()-&gt;系统调用的write()</p>
<p>可能有很多系统调用,但都通过中断向量表中的某一行进入-选择一条特殊指令作为陷入指令-每个系统调用具有编号和参数-每个系统调用的服务代码有入口地址,位于</p>
<h3 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h3><ul>
<li><p>只有一个指令进入系统调用,由这个陷入指令携带的参数长度有限</p>
</li>
<li><p>所以用通用寄存器-用户可见寄存器,用户内核可访问,<strong>好方法</strong></p>
</li>
<li><p>内存中开辟专门堆栈区-麻烦</p>
</li>
</ul>
<p>编号放在一个专用寄存器中,eax存放,还有其他参数推入寄存器</p>
<ol>
<li><p>int $0x80 特殊陷入指令:<strong>硬件</strong>保护现场,硬件查<strong>中断向量表</strong>-其中填写的是系统调用的总入口程序</p>
</li>
<li><p>系统调用总入口程序:<strong>软件</strong>保护现场(内核堆栈) 根据eax查<strong>系统调用表</strong></p>
</li>
<li>执行系统调用</li>
<li>恢复现场…</li>
</ol>
<p>15 陷阱门,不关门,还可以进来新的系统调用</p>
<p>3 </p>
<p>栈指针,四级,每级都有SS ESP栈指针,用哪级就从TSS中装哪个</p>
<p>system_call 系统调用总入口,</p>
<p>eax回去的时候存返回值</p>
<p>crl+C 中断 其实就是向进程发信号-Q(uit)</p>
<p>need_resched 是否需要重新调度-信号</p>
<h1 id="Nachos"><a href="#Nachos" class="headerlink" title="Nachos"></a>Nachos</h1><h2 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h2><p>规定了依赖关系,顺序,把Makefile基本看懂</p>
<h2 id="Nachos框架"><a href="#Nachos框架" class="headerlink" title="Nachos框架"></a>Nachos框架</h2><ol>
<li>内核几部分-全局变量</li>
<li>添加HelloWorld测试?</li>
<li>启动的流程 函数mian initi threadtest…</li>
<li>线程</li>
</ol>
<p>…</p>
<p>下次课</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/02/26/大数据专题notes/" rel="prev" title="大数据专题-笔记">
                大数据专题-笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">OliveDS</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/OliveDS" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:dengs1996@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/OliveDS" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-csdn"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#引言"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Course-Introduction"><span class="nav-number">1.1.</span> <span class="nav-text">Course Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#系统能力培养"><span class="nav-number">1.1.1.</span> <span class="nav-text">系统能力培养</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#三个层次："><span class="nav-number">1.1.1.1.</span> <span class="nav-text">三个层次：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#问题："><span class="nav-number">1.1.1.2.</span> <span class="nav-text">问题：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#教学目的："><span class="nav-number">1.1.2.</span> <span class="nav-text">教学目的：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#教学计划："><span class="nav-number">1.1.3.</span> <span class="nav-text">教学计划：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#课程环节："><span class="nav-number">1.1.4.</span> <span class="nav-text">课程环节：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考书："><span class="nav-number">1.1.5.</span> <span class="nav-text">参考书：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nachos操作系统"><span class="nav-number">1.2.</span> <span class="nav-text">Nachos操作系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#e-g-线程切换"><span class="nav-number">1.2.1.</span> <span class="nav-text">e.g. 线程切换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nachos体系结构"><span class="nav-number">1.2.2.</span> <span class="nav-text">Nachos体系结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实习要求"><span class="nav-number">1.2.3.</span> <span class="nav-text">实习要求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nachos系统源代码树结构"><span class="nav-number">1.2.4.</span> <span class="nav-text">Nachos系统源代码树结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XV6"><span class="nav-number">1.3.</span> <span class="nav-text">XV6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#课程目标"><span class="nav-number">1.4.</span> <span class="nav-text">课程目标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#典型名词术语"><span class="nav-number">1.4.1.</span> <span class="nav-text">典型名词术语</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#高速缓存-vs-TLB-vs-块高速缓存-Linux-文件缓存-Windows"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">高速缓存 vs TLB vs 块高速缓存(Linux)/文件缓存(Windows)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其它典型名词术语-E-G"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">其它典型名词术语 E.G.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#回顾知识点"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">回顾知识点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#操作系统"><span class="nav-number">1.5.</span> <span class="nav-text">操作系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#地位"><span class="nav-number">1.5.1.</span> <span class="nav-text">地位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#名称"><span class="nav-number">1.5.2.</span> <span class="nav-text">名称</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helloworld-程序运行时操作系统作用"><span class="nav-number">1.5.3.</span> <span class="nav-text">Helloworld 程序运行时操作系统作用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#作业"><span class="nav-number">1.6.</span> <span class="nav-text">作业</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#处理器调度"><span class="nav-number">2.</span> <span class="nav-text">处理器调度</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#三个层次"><span class="nav-number">2.1.</span> <span class="nav-text">三个层次</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理器调度-1"><span class="nav-number">2.2.</span> <span class="nav-text">处理器调度</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU调度时机"><span class="nav-number">2.2.1.</span> <span class="nav-text">CPU调度时机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程切换"><span class="nav-number">2.2.2.</span> <span class="nav-text">进程切换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤"><span class="nav-number">2.2.3.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#上下文切换开销"><span class="nav-number">2.2.4.</span> <span class="nav-text">上下文切换开销</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调度算法"><span class="nav-number">2.2.5.</span> <span class="nav-text">调度算法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#优先级和优先数"><span class="nav-number">2.2.5.1.</span> <span class="nav-text">优先级和优先数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#就绪队列组织"><span class="nav-number">2.2.5.2.</span> <span class="nav-text">就绪队列组织</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#抢占-amp-非抢占"><span class="nav-number">2.2.5.3.</span> <span class="nav-text">抢占&amp;非抢占</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#I-O密集型-CPU密集型进程"><span class="nav-number">2.2.5.4.</span> <span class="nav-text">I/O密集型/CPU密集型进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#时间片"><span class="nav-number">2.2.5.5.</span> <span class="nav-text">时间片</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#不同调度算法"><span class="nav-number">2.2.6.</span> <span class="nav-text">不同调度算法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#优先级反转-反置"><span class="nav-number">2.2.6.1.</span> <span class="nav-text">优先级反转/反置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解决"><span class="nav-number">2.2.6.2.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多级反馈队列"><span class="nav-number">2.2.6.3.</span> <span class="nav-text">多级反馈队列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一个例子"><span class="nav-number">2.2.6.4.</span> <span class="nav-text">一个例子</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#典型系统"><span class="nav-number">2.3.</span> <span class="nav-text">典型系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows"><span class="nav-number">2.3.1.</span> <span class="nav-text">Windows</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#线程优先级"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">线程优先级:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#调度策略"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">调度策略:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#优先级提升-amp-时间配额调整"><span class="nav-number">2.3.1.3.</span> <span class="nav-text">优先级提升&amp;时间配额调整</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux-CFS"><span class="nav-number">2.3.2.</span> <span class="nav-text">Linux CFS</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#中断-异常"><span class="nav-number">3.</span> <span class="nav-text">中断/异常</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#异常控制流-ECF"><span class="nav-number">3.1.</span> <span class="nav-text">异常控制流 ECF</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CPU"><span class="nav-number">3.2.</span> <span class="nav-text">CPU</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#状态转换"><span class="nav-number">3.3.</span> <span class="nav-text">状态转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中断-异常机制"><span class="nav-number">3.4.</span> <span class="nav-text">中断/异常机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#中断"><span class="nav-number">3.4.1.</span> <span class="nav-text">中断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#中断向量"><span class="nav-number">3.4.2.</span> <span class="nav-text">中断向量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#中断响应"><span class="nav-number">3.4.3.</span> <span class="nav-text">中断响应</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#中断处理程序"><span class="nav-number">3.4.4.</span> <span class="nav-text">中断处理程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x86的中断处理"><span class="nav-number">3.5.</span> <span class="nav-text">x86的中断处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统调用"><span class="nav-number">3.6.</span> <span class="nav-text">系统调用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数传递"><span class="nav-number">3.6.1.</span> <span class="nav-text">参数传递</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Nachos"><span class="nav-number">4.</span> <span class="nav-text">Nachos</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Makefile"><span class="nav-number">4.1.</span> <span class="nav-text">Makefile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nachos框架"><span class="nav-number">4.2.</span> <span class="nav-text">Nachos框架</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">OliveDS</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'uaU7K98rSYcLih6bDPXI5vbf-gzGzoHsz',
        appKey: 'lfonkoBe1cGLNBLsjTuWaae9',
        placeholder: '请给菜鸡小码农一点意见和建议吧ε٩(๑> ₃ <)۶з',
        avatar:'identicon',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("uaU7K98rSYcLih6bDPXI5vbf-gzGzoHsz", "lfonkoBe1cGLNBLsjTuWaae9");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
